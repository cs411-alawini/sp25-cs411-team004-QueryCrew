<!DOCTYPE html>
<html>
<head>
  <title>Rental Form</title>
</head>
<body>
  <div class="container mt-5">
    <h2>Rental Information</h2>
    <form id="rentalForm">
      <input type="hidden" id="carId" />
      <input type="hidden" id="customerId" />
      <input type="hidden" id="rate" />

      <label>Start Time:</label>
      <input type="text" id="startTime" placeholder="YYYY-MM-DD HH:MM:SS AM/PM" required><br>

      <label>End Time:</label>
      <input type="text" id="endTime" placeholder="YYYY-MM-DD HH:MM:SS AM/PM" required><br>

      <label>Purpose:</label>
      <input type="text" id="purpose" required><br>

      <label>Miles:</label>
      <input type="number" id="miles" required><br>

      <p id="totalCostDisplay">Total Cost: $0.00</p>

      <button type="submit">Continue</button>
    </form>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const rate = parseFloat(urlParams.get('rate'));
    document.getElementById('carId').value = urlParams.get('car_id');
    document.getElementById('customerId').value = urlParams.get('customer_id');
    document.getElementById('rate').value = rate;

    function calculateTotalCost() {
      const start = new Date(document.getElementById('startTime').value);
      const end = new Date(document.getElementById('endTime').value);
      const hours = (end - start) / (1000 * 60 * 60);
      if (hours > 0) {
        const total = (hours * rate).toFixed(2);
        document.getElementById('totalCostDisplay').innerText = `Total Cost: $${total}`;
      }
    }

    document.getElementById('startTime').addEventListener('blur', calculateTotalCost);
    document.getElementById('endTime').addEventListener('blur', calculateTotalCost);

    document.getElementById('rentalForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const params = new URLSearchParams({
        car_id: document.getElementById('carId').value,
        customer_id: document.getElementById('customerId').value,
        start: document.getElementById('startTime').value,
        end: document.getElementById('endTime').value,
        purpose: document.getElementById('purpose').value,
        miles: document.getElementById('miles').value,
        rate: rate
      });

      window.location.href = `/after_rental?${params.toString()}`;
    });
  </script>
</body>
</html>
