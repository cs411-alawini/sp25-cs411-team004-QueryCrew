<!DOCTYPE html>
<html>
<head>
  <title>Rental Form</title>
</head>
<body>
  <div class="container mt-5">
    <h2>Rental Information</h2>
    <form id="rentalForm">
      <input type="hidden" id="carId" />
      <input type="hidden" id="customerId" />
      <input type="hidden" id="rate" />

      <input type="datetime-local" id="startTime" required>
      <input type="datetime-local" id="endTime" required>
      
      <label>Purpose:</label>
      <input type="text" id="purpose" required><br>

      <label>Miles:</label>
      <input type="number" id="miles" required><br>

      <p id="totalCostDisplay">Total Cost: $0.00</p>

      <button type="submit">Continue</button>
    </form>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const rate = parseFloat(urlParams.get('rate'));
    document.getElementById('carId').value = urlParams.get('car_id');
    document.getElementById('customerId').value = urlParams.get('customer_id');
    document.getElementById('rate').value = rate;

    // function calculateTotalCost() {
    //   const startRaw = document.getElementById('startTime').value;
    //   const endRaw = document.getElementById('endTime').value;
    //   const start = new Date(startRaw);
    //   const end = new Date(endRaw);
    //   const hours = (end - start) / (1000 * 60 * 60);
    //   if (hours > 0) {
    //     const total = (hours * rate).toFixed(2);
    //     document.getElementById('totalCostDisplay').innerText = `Total Cost: $${total}`;
    //   }
    // }
    function toMySQLFormat(date) {
    return date.toISOString().slice(0, 19).replace('T', ' ');
  }

    document.getElementById('startTime').addEventListener('blur', calculateTotalCost);
    document.getElementById('endTime').addEventListener('blur', calculateTotalCost);

    document.getElementById('rentalForm').addEventListener('submit', function(event) {
  event.preventDefault();

  const pickupGarageId = urlParams.get('pickup_garage_id');
  const rate = parseFloat(document.getElementById('rate').value);
  const startRaw = document.getElementById('startTime').value;
  const endRaw = document.getElementById('endTime').value;
  const start = new Date(startRaw);
  const end = new Date(endRaw);
  const hours = (end - start) / (1000 * 60 * 60);
  if (hours > 0) {
    const total = (hours * rate).toFixed(2);
    document.getElementById('totalCostDisplay').innerText = `Total Cost: $${total}`;
  }

  const params = new URLSearchParams({
    car_id: document.getElementById('carId').value,
    customer_id: document.getElementById('customerId').value,
    start: toMySQLFormat(start),
    end: toMySQLFormat(end),
    purpose: document.getElementById('purpose').value,
    miles: document.getElementById('miles').value,
    pickup_garage_id: pickupGarageId,
    total_cost: total
  });

  console.log("Redirecting with params:", params.toString());
  window.location.href = `/after_rental?${params.toString()}`;
});
  </script>
</body>
</html>
